<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åº·è»’åœ‹èªå…­ä¸Šç¬¬ä¹èª²èªè©è³“æœ4x4</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            box-sizing: border-box;
        }
        
        .card {
            transition: all 0.3s ease;
            cursor: pointer;
            aspect-ratio: 1; /* ä¿æŒå¡ç‰‡ç‚ºæ­£æ–¹å½¢ */
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .card-content {
            transition: opacity 0.2s ease;
        }
        
        .animal-emoji {
            font-size: 4rem;
        }
        
        /* è³“æœé€£ç·šçš„ç´…ç·šæ¨£å¼ */
        .bingo-line {
            position: absolute;
            background-color: #ef4444; /* Tailwind red-500 */
            z-index: 20;
            border-radius: 9999px; /* fully rounded */
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
            transition: opacity 0.5s ease;
        }

        /* è¬ç”¨æ ¼ (PASS) å°ˆå±¬æ¨£å¼ */
        .pass-card {
             /* ä¿æŒèˆ‡èªè©ç‹€æ…‹ä¸€è‡´çš„ç¶ è‰²èª¿ï¼Œä½†åŠ å…¥ç‰¹æ®Šé™°å½± */
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 10px rgba(0,0,0,0.15);
            transform: scale(1.03); /* ç¨å¾®çªå‡º */
        }

        /* è¨Šæ¯æ¡†æ¨£å¼ */
        #messageBox {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        #messageBox.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* ç°¡å–®çš„å½©å¸¶ï¼ˆConfettiï¼‰æ•ˆæœå®¹å™¨ */
        #confettiContainer {
            position: fixed; /* Fixed position to cover the entire viewport */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 50; /* Above everything else */
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* ç°¡å–®çš„å½©å¸¶å…ƒç´ å‹•ç•« */
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: transparent;
            border-radius: 50%;
            animation: confetti-fall 3s ease-in-out forwards;
            opacity: 0.8;
            transform-origin: center;
        }

        @keyframes confetti-fall {
            0% { transform: translate(var(--startX), -5vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translate(var(--endX), 105vh) rotate(720deg); opacity: 0; }
        }
        
        /* å…¶ä»–å¡ç‰‡æ–‡å­—æ¨£å¼ä¿æŒä¸è®Š */
        .definition-text {
            font-size: 1.0rem !important; 
            line-height: 1.2;
            overflow-wrap: break-word;
            word-break: break-word;
        }
        
        .term-text {
            font-size: 2.5rem; 
            font-weight: 600;
        }
    </style>
 </head>
 <body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-full p-4">
    <!-- 3ç§’å½©å¸¶å‹•ç•«å®¹å™¨ (fixed position) -->
    <div id="confettiContainer"></div>
    
  <div class="max-w-6xl mx-auto">
   <!-- æ¨™é¡Œï¼šå·²åˆä½µç‚ºå–®è¡Œ -->
   <div class="text-center mb-6">
    <h1 class="text-4xl font-bold text-gray-800 mb-2">åº·è»’åœ‹èªå…­ä¸Šç¬¬ä¹èª²èªè©è³“æœ4x4</h1>
   </div>
   <div class="flex justify-center mb-6">
       <button id="resetButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg shadow-xl transition duration-150 transform hover:scale-105">
           é‡æ–°é–‹å§‹
       </button>
   </div>
   
   <!-- å¡ç‰‡ç¶²æ ¼å®¹å™¨ (æ–°å¢ç›¸å°å®šä½) -->
   <div class="max-w-4xl mx-auto relative">
        <!-- Bingo Grid with ID -->
        <div class="grid grid-cols-4 gap-4" id="bingoGrid">
            <!-- å¡ç‰‡æœƒç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
        </div>
        <!-- Line and Confetti Overlay (çµ•å°å®šä½ï¼Œç”¨æ–¼ç¹ªè£½ç´…ç·š) -->
        <div id="bingoOverlay" class="absolute inset-0 pointer-events-none">
            <!-- Red lines will be inserted here -->
        </div>
   </div>
   
   <!-- èªªæ˜ -->
   <div class="text-center mt-8 p-4 bg-white/70 rounded-lg backdrop-blur-sm max-w-4xl mx-auto">
    <p class="text-gray-700">ğŸ’¡ æç¤ºï¼šé»æ“Šå¡ç‰‡ï¼Œå¾ªç’°åˆ‡æ› **åœ–æ¡ˆ** â†’ **è§£é‡‹** â†’ **èªè© (æ¨™è¨˜)** ä¸‰å€‹ç‹€æ…‹ã€‚</p>
   </div>
  </div>

  <script>
        // èªè©è³‡æ–™ (9å€‹æ–°èªè© + 7å€‹PASSæ ¼ = 16å€‹)
        const vocabularyData = [
            // åº·è»’åœ‹èªå…­ä¸Šç¬¬ä¹èª²çš„æ–°èªè©
            { term: "èª˜æ•µ", definition: "å¼•èª˜æ•µäººã€‚", animal: "ğŸªŸ" },
            { term: "æ——å¹Ÿ", definition: "â‘´æ——æœ‰æ¨™å¹Ÿçš„åŠŸç”¨ï¼Œæ‰€ä»¥æ³›ç¨±æ—Œæ——ç‚ºï¹æ——å¹Ÿï¹‚ã€‚â‘µæ¯”å–»åç¾©ã€è—‰å£ã€‚", animal: "ğŸ“œ" },
            { term: "å´—ä½", definition: "â‘´è·è²¬ã€æœ¬åˆ†ã€‚â‘µè»è­¦åŸ·å‹¤çš„è™•æ‰€ã€‚", animal: "â˜•" },
            { term: "ç™¾å§“", definition: "æ³›æŒ‡ä¸€èˆ¬å¹³æ°‘ã€åœ‹æ°‘ã€‚", animal: "ğŸ“–" },
            { term: "å€˜è‹¥", definition: "è¡¨ç¤ºå‡è¨­èªæ°£çš„é€£æ¥è©ï¼Œå³å¦‚æœã€å‡ä½¿ã€‚", animal: "ğŸ¦…" },
            { term: "æ›¸åƒ®", definition: "èˆŠæ™‚åœ¨å¯Œäººå®¶ä¸­ä¾å€™ä¸»äººæˆ–å…¶å¼Ÿå­è®€æ›¸ï¼Œå…¼åšé›œå½¹çš„æœªæˆå¹´åƒ®åƒ•ã€‚", animal: "ğŸ°" },
            { term: "æ’¤é€€", definition: "æ”¾æ£„é™£åœ°æˆ–é·é›¢å·²å é ˜çš„åœ°å€ã€‚", animal: "ğŸ¦Š" },
            { term: "è¬¹æ…", definition: "ä»”ç´°æ…é‡ã€‚", animal: "ğŸ­" },
            { term: "ä¸ç›¸", definition: "å¤æ™‚è¼”ä½å¤©å­è™•ç†åœ‹äº‹çš„æœ€é«˜è¡Œæ”¿å®˜å“¡ã€‚", animal: "ğŸ“¢" },
            // ç‚ºäº†ä¿æŒ 4x4 (16å¼µå¡ç‰‡)ï¼Œå…¶é¤˜å¡«å……ç‚º PASS è¬ç”¨æ ¼
            // è¬ç”¨æ ¼ (PASS) çµ±ä¸€ä½¿ç”¨è‹±æ–‡ PASS ä½œç‚ºèªè©é¡¯ç¤º
            { term: "PASS", definition: "è¬ç”¨æ ¼ï¼Œå¯è‡ªç”±é¸æ“‡æ˜¯å¦ç¿»é–‹ã€‚", animal: "â­" }, 
            { term: "PASS", definition: "è¬ç”¨æ ¼ï¼Œå¯è‡ªç”±é¸æ“‡æ˜¯å¦ç¿»é–‹ã€‚", animal: "ğŸ”" },
            { term: "PASS", definition: "è¬ç”¨æ ¼ï¼Œå¯è‡ªç”±é¸æ“‡æ˜¯å¦ç¿»é–‹ã€‚", animal: "ğŸ¤¥" },
            { term: "PASS", definition: "è¬ç”¨æ ¼ï¼Œå¯è‡ªç”±é¸æ“‡æ˜¯å¦ç¿»é–‹ã€‚", animal: "ğŸ¨" },
            { term: "PASS", definition: "è¬ç”¨æ ¼ï¼Œå¯è‡ªç”±é¸æ“‡æ˜¯å¦ç¿»é–‹ã€‚", animal: "âš ï¸" },
            { term: "PASS", definition: "è¬ç”¨æ ¼ï¼Œå¯è‡ªç”±é¸æ“‡æ˜¯å¦ç¿»é–‹ã€‚", animal: "ğŸ‘€" },
            { term: "PASS", definition: "è¬ç”¨æ ¼ï¼Œå¯è‡ªç”±é¸æ“‡æ˜¯å¦ç¿»é–‹ã€‚", animal: "ğŸ™ˆ" }
        ];

        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        let vocabulary = []; // ç•¶å‰è¢«æ‰“äº‚çš„èªè©é †åº
        let cardStates = []; // å¡ç‰‡ç‹€æ…‹ï¼š0=å‹•ç‰©, 1=è§£é‡‹, 2=èªè©(æ¨™è¨˜)
        let markedCards = []; // è³“æœæ¨™è¨˜ç‹€æ…‹ (å¸ƒæ—å€¼)

        // éš¨æ©Ÿæ‰“äº‚é™£åˆ—
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // -----------------------
        // è³“æœéŠæˆ²æ ¸å¿ƒé‚è¼¯
        // -----------------------

        // é¡¯ç¤ºè¨Šæ¯æ¡†ï¼ˆå–ä»£ alert()ï¼‰
        function showMessage(title, message) {
            let messageBox = document.getElementById('messageBox');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'messageBox';
                messageBox.className = 'fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300';
                document.body.appendChild(messageBox);
            }
            
            messageBox.innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm text-center transform scale-100 transition-transform duration-300">
                    <div class="text-4xl mb-4">${title === "è³“æœï¼" ? "ğŸ‰" : "ğŸ’¡"}</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">${title}</h2>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button onclick="document.getElementById('messageBox').classList.remove('active')" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition duration-150">
                        ç¢ºå®š
                    </button>
                </div>
            `;
             messageBox.classList.add('active');
        }

        // é¡¯ç¤ºå½©å¸¶ç•«é¢ (Confetti) 3ç§’
        function showConfetti() {
            const container = document.getElementById('confettiContainer');
            if (!container) return;
            
            // Show container
            container.innerHTML = ''; // Clear previous confetti
            container.style.opacity = '1';
            
            const colors = ['#f43f5e', '#6366f1', '#10b981', '#f59e0b', '#3b82f6']; // Tailwind colors
            const count = 50; // å½©å¸¶æ•¸é‡

            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                const size = Math.random() * 8 + 4; // 4px to 12px
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                // Random start/end X positions for falling effect
                const startX = Math.random() * 100 + 'vw';
                const endX = Math.random() * 100 + 'vw';

                // Set CSS variables for animation
                confetti.style.setProperty('--startX', startX);
                confetti.style.setProperty('--endX', endX);

                // Delay the animation slightly
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                
                container.appendChild(confetti);
            }

            // Hide after 3 seconds
            setTimeout(() => {
                container.style.opacity = '0';
                // Clean up confetti elements after transition
                setTimeout(() => {
                    container.innerHTML = '';
                }, 500); 
            }, 3000);
        }

        // ç¹ªè£½è³“æœé€£ç·š
        function drawBingoLines(lines) {
            const overlay = document.getElementById('bingoOverlay');
            if (!overlay) return;

            // æ¸…é™¤ä¹‹å‰çš„é€£ç·š
            overlay.innerHTML = '';

            const grid = document.getElementById('bingoGrid');
            if (!grid) return;
            // ç¢ºä¿ gridRect åœ¨å‡½æ•¸åŸ·è¡Œæ™‚æ˜¯æœ€æ–°çš„
            const gridRect = grid.getBoundingClientRect();
            
            // ç²å–å¡ç‰‡å…ƒç´ åˆ—è¡¨
            const cardElements = Array.from(grid.children);
            
            lines.forEach(indices => {
                // ç²å–é€£ç·šçš„èµ·é»å¡ç‰‡ (ç¬¬ä¸€å€‹) å’Œçµ‚é»å¡ç‰‡ (æœ€å¾Œä¸€å€‹)
                const startCard = cardElements[indices[0]];
                const endCard = cardElements[indices[indices.length - 1]];

                if (!startCard || !endCard) return;

                const startRect = startCard.getBoundingClientRect();
                const endRect = endCard.getBoundingClientRect();

                // è¨ˆç®—ç›¸å°æ–¼ overlay/grid container çš„ä¸­å¿ƒé»ä½ç½®
                const startX = startRect.left + startRect.width / 2 - gridRect.left;
                const startY = startRect.top + startRect.height / 2 - gridRect.top;
                const endX = endRect.left + endRect.width / 2 - gridRect.left;
                const endY = endRect.top + endRect.height / 2 - gridRect.top;

                // è¨ˆç®—è·é›¢ (é•·åº¦) å’Œè§’åº¦
                const dx = endX - startX;
                const dy = endY - startY;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                // å‰µå»ºä¸¦è¨­å®šé€£ç·šå…ƒç´ æ¨£å¼
                const line = document.createElement('div');
                line.className = 'bingo-line';
                // èµ·é»è¨­ç‚ºç¬¬ä¸€å€‹å¡ç‰‡ä¸­å¿ƒ
                line.style.left = `${startX}px`;
                line.style.top = `${startY}px`;
                // é•·åº¦ç‚ºå…©å€‹ä¸­å¿ƒé»çš„è·é›¢
                line.style.width = `${length}px`;
                line.style.height = '8px'; // ç´…ç·šç²—ç´°
                line.style.transformOrigin = '0 0'; // æ—‹è½‰çš„åŸé»
                line.style.transform = `rotate(${angle}deg)`;

                overlay.appendChild(line);
            });
        }

        // æª¢æŸ¥æ˜¯å¦é”æˆè³“æœ
        function checkForBingo() {
            const size = 4;
            const lines = []; // å„²å­˜é”æˆé€£ç·šçš„å¡ç‰‡ç´¢å¼•åˆ—è¡¨
            
            // è¼”åŠ©å‡½å¼ï¼šæª¢æŸ¥ä¸¦æ·»åŠ é€£ç·š
            function addLine(indices) {
                // ç¢ºä¿æ‰€æœ‰ç´¢å¼•å°æ‡‰çš„å¡ç‰‡éƒ½è¢«æ¨™è¨˜ (ç‹€æ…‹ç‚º 2)
                if (indices.every(i => markedCards[i])) {
                    lines.push(indices);
                }
            }

            // æª¢æŸ¥æ©«æ’ (Rows)
            for (let i = 0; i < size; i++) {
                const rowIndices = [];
                for (let j = 0; j < size; j++) {
                    rowIndices.push(i * size + j);
                }
                addLine(rowIndices);
            }

            // æª¢æŸ¥ç›´è¡Œ (Columns)
            for (let j = 0; j < size; j++) {
                const colIndices = [];
                for (let i = 0; i < size; i++) {
                    colIndices.push(i * size + j);
                }
                addLine(colIndices);
            }

            // æª¢æŸ¥å°è§’ç·š (Diagonals)
            // Diag 1 (å·¦ä¸Šåˆ°å³ä¸‹)
            const diag1Indices = [];
            for (let i = 0; i < size; i++) {
                diag1Indices.push(i * size + i);
            }
            addLine(diag1Indices);

            // Diag 2 (å³ä¸Šåˆ°å·¦ä¸‹)
            const diag2Indices = [];
            for (let i = 0; i < size; i++) {
                diag2Indices.push(i * size + (size - 1 - i));
            }
            addLine(diag2Indices);

            if (lines.length > 0) {
                showMessage("è³“æœï¼", `æ­å–œæ‚¨é”æˆ ${lines.length} æ¢é€£ç·šï¼`);
                drawBingoLines(lines); // ç¹ªè£½ç´…ç·š
                showConfetti(); // é¡¯ç¤ºå½©å¸¶å‹•ç•«
            } else {
                 // å¦‚æœæ²’æœ‰è³“æœï¼Œæ¸…é™¤é€£ç·š
                document.getElementById('bingoOverlay').innerHTML = '';
            }
        }
        
        // -----------------------
        // å¡ç‰‡é¡¯ç¤ºé‚è¼¯
        // -----------------------
        
        // å°‡æ–‡å­—æŒ‰æ¯è¡Œ6å€‹å­—æ’åˆ— (ç¬¬ä¸ƒå€‹å­—å…ƒæ›è¡Œ)ï¼Œä¸¦é¿å…æœ«è¡Œåƒ… 1 æˆ– 2 å­—
        function formatTextIn6x4(text) {
            const chars = [];
            const charsPerLine = 6; 
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                chars.push(char);
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºä¸€å€‹å®Œæ•´è¡Œçš„çµå°¾ 
                const isEndOfChunk = (i + 1) % charsPerLine === 0;
                
                // æª¢æŸ¥å¾Œé¢æ˜¯å¦é‚„æœ‰å­—å…ƒ (é¿å…åœ¨æœ€å¾Œä¸€å€‹å­—å…ƒå¾Œæ›è¡Œ)
                const hasMoreChars = i < text.length - 1;
                
                if (isEndOfChunk && hasMoreChars) {
                    // è¨ˆç®—å‰©ä¸‹çš„å­—å…ƒæ•¸
                    const remainingChars = text.length - (i + 1);
                    
                    // åªæœ‰ç•¶å‰©ä¸‹çš„å­—å…ƒæ•¸è¶…é 2 æ™‚æ‰æ›è¡Œ 
                    if (remainingChars > 2) { 
                        chars.push('<br>');
                    }
                }
            }
            
            return chars.join('');
        }

        // æ›´æ–°å¡ç‰‡å…§å®¹
        function updateCardContent(index) {
            const content = document.getElementById(`card-${index}`);
            const item = vocabulary[index];
            const state = cardStates[index];
            
            // æ¸…é™¤ä¹‹å‰çš„PASSæ¨£å¼
            content.parentElement.classList.remove('pass-card');
            
            if (state === 0) {
                // å‹•ç‰©ç‹€æ…‹ (é è¨­ç‹€æ…‹)
                content.innerHTML = `<div class="animal-emoji">${item.animal}</div>`;
                content.parentElement.className = 'card bg-gradient-to-br from-yellow-100 to-orange-100 rounded-xl shadow-lg p-4 flex items-center justify-center border-2 border-yellow-200';
            } else if (state === 1) {
                // è§£é‡‹ç‹€æ…‹
                const formattedText = formatTextIn6x4(item.definition); // ä½¿ç”¨å„ªåŒ–å¾Œçš„ 6 å­—ä¸€è¡Œçš„æ ¼å¼åŒ–å‡½æ•¸
                content.innerHTML = `<div class="definition-text text-gray-700 px-2 text-center">${formattedText}</div>`;
                content.parentElement.className = 'card bg-gradient-to-br from-blue-100 to-purple-100 rounded-xl shadow-lg p-4 flex items-center justify-center border-2 border-blue-200';
                
            } else {
                // èªè©ç‹€æ…‹ (æ¨™è¨˜ç‹€æ…‹)
                let termText = item.term;
                
                // è¬ç”¨æ ¼åªé¡¯ç¤º PASS è‹±æ–‡
                if (item.term === "PASS") {
                    termText = "PASS"; 
                    content.parentElement.classList.add('pass-card'); // åŠ ä¸Šç‰¹æ®Šæ¨£å¼
                }

                content.innerHTML = `<div class="term-text text-gray-800">${termText}</div>`;
                content.parentElement.className = 'card bg-gradient-to-br from-green-100 to-teal-100 rounded-xl shadow-lg p-4 flex items-center justify-center border-2 border-green-200';
            }
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playClickSound() {
            // ä½¿ç”¨Web Audio APIå‰µå»ºç°¡å–®çš„é»æ“ŠéŸ³æ•ˆ
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // åˆ‡æ›å¡ç‰‡ç‹€æ…‹ (å·²æ ¹æ“šç”¨æˆ¶è¦æ±‚ä¿®æ”¹è¬ç”¨æ ¼é‚è¼¯)
        function toggleCard(index) {
            playClickSound();
            const isPassCard = vocabulary[index].term === "PASS";
            
            if (isPassCard) {
                // PASSå¡ç‰‡ï¼šåªåœ¨ 0 (åœ–æ¡ˆ) å’Œ 2 (PASS) ä¹‹é–“åˆ‡æ›
                if (cardStates[index] === 0) {
                    cardStates[index] = 2; // 0 -> 2
                } else {
                    cardStates[index] = 0; // 2 -> 0 (æ‰€æœ‰é 0 çš„éƒ½å›åˆ° 0)
                }
            } else {
                // ä¸€èˆ¬å¡ç‰‡ï¼šå¾ªç’° 0 (åœ–æ¡ˆ), 1 (è§£é‡‹), 2 (èªè©)
                cardStates[index] = (cardStates[index] + 1) % 3;
            }

            updateCardContent(index);

            // å¦‚æœå¡ç‰‡åˆ‡æ›åˆ°èªè©ç‹€æ…‹(2)ï¼Œå‰‡è¦–ç‚ºæ¨™è¨˜
            markedCards[index] = cardStates[index] === 2;
            
            checkForBingo(); // æ¯æ¬¡æ¨™è¨˜å¾Œæª¢æŸ¥è³“æœ
        }

        // ç”Ÿæˆ/é‡è¨­å¡ç‰‡å’ŒéŠæˆ²ç‹€æ…‹
        function initializeGame() {
            vocabulary = shuffleArray(vocabularyData);
            cardStates = new Array(vocabulary.length).fill(0);
            markedCards = new Array(vocabulary.length).fill(false);
            
            const grid = document.getElementById('bingoGrid');
            grid.innerHTML = ''; // æ¸…é™¤èˆŠå¡ç‰‡
            
            // æ¸…é™¤é€£ç·šå’Œå½©å¸¶æ•ˆæœ
            document.getElementById('bingoOverlay').innerHTML = '';
            const confettiContainer = document.getElementById('confettiContainer');
            if (confettiContainer) {
                confettiContainer.style.opacity = '0';
                confettiContainer.innerHTML = '';
            }

            // ç”Ÿæˆå¡ç‰‡
            vocabulary.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card bg-white rounded-xl shadow-lg p-4 flex items-center justify-center border-2 border-gray-100';
                card.onclick = () => toggleCard(index);
                
                const content = document.createElement('div');
                content.className = 'card-content text-center w-full h-full flex items-center justify-center';
                content.id = `card-${index}`;
                
                card.appendChild(content);
                grid.appendChild(card);
                
                updateCardContent(index);
            });
            
            // ç§»é™¤å¯èƒ½å­˜åœ¨çš„è¨Šæ¯æ¡†
            document.getElementById('messageBox')?.classList.remove('active'); 
        }
        
        // å•Ÿå‹•éŠæˆ²å’Œç¶å®šæŒ‰éˆ•äº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–éŠæˆ²
            initializeGame();

            // ç¶å®šé‡æ–°é–‹å§‹æŒ‰éˆ•äº‹ä»¶
            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                resetButton.addEventListener('click', initializeGame);
            }
        });
    </script>
 </body>
</html>