<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‡ªè¨‚ç”Ÿå­—å¤šå¯¶éŠæˆ²</title>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
  <style>
        /* é é¢åŸºç¤è¨­å®š */
        body {
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'Heiti TC', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 0;
            height: 100vh; /* å›ºå®šé«˜åº¦ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; 
            overflow: hidden; /* éš±è—æ²è»¸ */
        }

        /* éŠæˆ²åŒ…è£¹å±¤ */
        .game-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center; /* å‚ç›´ç½®ä¸­ */
            justify-content: center;
            padding-top: 0;
            padding-bottom: 0;
        }

        .game-container {
            width: 100%;
            text-align: center;
            position: relative;
            display: flex; /* é è¨­éš±è—ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            flex-direction: column;
            align-items: center;
            transform-origin: center center;
        }

        /* è¨­å®šé¢æ¿ (è¼¸å…¥ç”Ÿå­—ç•«é¢) */
        .setup-panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 600px;
            width: 90%;
            z-index: 2000;
        }

        .setup-title {
            font-size: 2rem;
            color: #4a5568;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .input-area {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            font-size: 1.2rem;
            margin-bottom: 20px;
            resize: none;
        }

        .input-hint {
            color: #718096;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        /* éŠæˆ²è³‡è¨Š (é¡Œè™Ÿã€åˆ†æ•¸) */
        .game-info {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 5px 20px; 
            margin-top: 5px;   
            margin-bottom: 5px; 
            color: white;
            display: inline-block;
            position: relative;
            z-index: 20; 
        }

        .question-number {
            font-size: 1.3rem;
            font-weight: bold;
        }

        /* æ§åˆ¶å€ (æŒ‰éˆ•) */
        .controls {
            margin: 0; 
            position: relative;
            z-index: 20; 
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 25px; 
            font-size: 1.1rem;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* ç‚ºé‡æ–°å‡ºé¡ŒæŒ‰éˆ•è¨­è¨ˆä¸åŒé¡è‰² */
        .btn-setup {
            background: linear-gradient(45deg, #FF9966, #FF5E62);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* å¡ç‰‡å®¹å™¨ */
        .cards-container {
            display: flex;
            justify-content: center;
            gap: 120px; 
            /* ä¿®æ­£é€™è£¡ï¼šæ”¹ç‚º -30pxï¼Œè®“åœ“åœˆå¾€ä¸‹ç§»å‹•ï¼Œä¸æ“‹ä½ä¸Šæ–¹æ–‡å­— */
            margin: -30px 0 0 0; 
            flex-wrap: nowrap;
            width: 100%;
            align-items: center;
            padding-bottom: 10px;
            z-index: 1; 
        }

        /* åœ“å½¢å¡ç‰‡æ¨£å¼ */
        .card {
            width: 520px;
            height: 520px;
            border-radius: 50%;
            background: white;
            border: 8px solid white;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            position: relative;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        /* å­—å…ƒå®¹å™¨ */
        .character {
            font-size: 5rem; 
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            border-radius: 8px;
            user-select: none;
            position: absolute;
            width: 90px;
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .character span {
            display: block;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .character.correct span {
            transform: scale(1.5);
            text-shadow: 0 0 20px rgba(255,215,0,0.5);
        }
        
        .character.correct {
            z-index: 50;
        }

        .feedback {
            margin: 0;
            height: 1px;
            visibility: hidden;
        }

        .game-complete {
            background: rgba(76, 175, 80, 0.95);
            border-radius: 20px;
            padding: 40px;
            color: white;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 200;
            text-align: center;
        }

        /* æ…¶ç¥å‹•ç•«ç‰¹æ•ˆ */
        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            background: #f0f;
            animation: confetti-fall 3s linear forwards;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .ribbon {
            position: fixed;
            top: 0;
            width: 120px;
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3);
            background-size: 400% 400%;
            animation: ribbon-wave 2s ease-in-out, gradient-shift 3s ease-in-out;
            z-index: 999;
            opacity: 0;
        }

        .ribbon.left { left: 0; transform: translateX(-100%); }
        .ribbon.right { right: 0; transform: translateX(100%); }

        @keyframes ribbon-wave {
            0% { opacity: 0; transform: translateX(-100%); }
            20% { opacity: 1; transform: translateX(0); }
            80% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(-100%); }
        }

        @keyframes gradient-shift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* éŸ¿æ‡‰å¼èˆ‡è‡ªå‹•ç¸®æ”¾é‚è¼¯ */
        @media (max-height: 900px) {
            .game-container {
                transform: scale(0.85); 
            }
        }
        @media (max-height: 750px) {
            .game-container {
                transform: scale(0.7);
            }
        }

        @media (max-width: 1200px) {
            .cards-container {
                gap: 50px;
                transform: scale(0.9);
            }
        }
        
        @media (max-width: 768px) {
            .game-wrapper {
                padding-top: 10px;
            }
            .cards-container {
                transform: scale(0.55);
                margin-top: -30px; 
                margin-bottom: -150px;
                gap: 20px;
            }
            .setup-panel {
                width: 95%;
                padding: 20px;
            }
        }
  </style>
 </head>
 <body>

  <div class="game-wrapper">
    <!-- è¨­å®šé¢æ¿ (åˆå§‹é¡¯ç¤º) -->
    <div id="setupPanel" class="setup-panel">
        <h2 class="setup-title">è‡ªè¨‚ç”Ÿå­—å¤šå¯¶éŠæˆ²</h2>
        <p class="input-hint">è«‹è¼¸å…¥æƒ³è¦ç·´ç¿’çš„ç”Ÿå­— (è‡³å°‘ 6 å€‹å­—ï¼Œå»ºè­° 15 å€‹å­—ä»¥ä¸Šä»¥é”åˆ°æœ€ä½³ 8 å­—/å¡æ•ˆæœ)</p>
        <textarea id="wordInput" class="input-area" placeholder="è«‹åœ¨æ­¤è¼¸å…¥ç”Ÿå­—ï¼Œä¾‹å¦‚ï¼š
å¤©é«˜åœ°åšé¢¨å’Œæ—¥éº—..."></textarea>
        <div>
            <button class="btn" onclick="initializeGame()">ç¢ºå®š (é–‹å§‹éŠæˆ²)</button>
        </div>
    </div>

    <!-- éŠæˆ²ä¸»ç•«é¢ (åˆå§‹éš±è—) -->
    <div id="gameContainer" class="game-container" style="display: none;">
        
        <!-- ç¬¬ä¸€è¡Œï¼šè³‡è¨Šåˆ— -->
        <div class="game-info">
            <div class="question-number">
            ç¬¬ <span id="currentQuestion">1</span> é¡Œ / å…± <span id="totalQuestions">0</span> é¡Œã€€å¾—åˆ†: <span id="score">0</span> åˆ†
            </div>
        </div>

        <!-- ç¬¬äºŒè¡Œï¼šæŒ‰éˆ•å€ -->
        <div class="controls">
            <button class="btn btn-setup" onclick="returnToSetup()">é‡æ–°å‡ºé¡Œ</button>
            <button class="btn" id="restartBtn" onclick="restartLevel()">é‡æ–°é–‹å§‹</button>
            <button class="btn" id="nextBtn" onclick="nextQuestion()" disabled>ä¸‹ä¸€é¡Œ</button>
        </div>

        <!-- ç¬¬ä¸‰è¡Œï¼šå¡ç‰‡å€ -->
        <div class="cards-container">
            <div class="card left" id="leftCard"></div>
            <div class="card right" id="rightCard"></div>
        </div>

        <div class="feedback" id="feedback"></div>

        <div id="gameComplete" class="game-complete" style="display: none;">
            <h2 style="font-size: 2.5rem; margin-bottom: 20px;">ğŸ‰ éŠæˆ²å®Œæˆï¼</h2>
            <p style="font-size: 1.5rem;">æœ€çµ‚å¾—åˆ†ï¼š<span id="finalScore"></span> åˆ† / <span id="maxScore">17</span> åˆ†</p>
            <p style="font-size: 1.2rem; margin-top: 10px;">è¡¨ç¾å¾ˆæ£’ï¼ç¹¼çºŒåŠ æ²¹ï¼</p>
            <div style="margin-top: 20px;">
                <button class="btn" onclick="restartLevel()" style="background: white; color: #4CAF50; margin-right: 10px;">å†ç©ä¸€æ¬¡</button>
                <button class="btn" onclick="returnToSetup()" style="background: white; color: #667eea;">ä¿®æ”¹ç”Ÿå­—</button>
            </div>
        </div>
    </div>
  </div>

  <script>
        let characters = []; // å„²å­˜ä½¿ç”¨è€…è¼¸å…¥çš„ç”Ÿå­—
        let currentQuestionNum = 1;
        let score = 0;
        let gameQuestions = [];
        let currentAnswer = '';
        let questionAnswered = false;
        let symbolsPerCard = 8; // é è¨­æ¯å¼µå¡ç‰‡å­—æ•¸

        // åˆå§‹åŒ–éŠæˆ² (æŒ‰ä¸‹ç¢ºå®šå¾Œ)
        function initializeGame() {
            const input = document.getElementById('wordInput').value;
            const uniqueChars = [...new Set(input.split('').filter(c => c.trim() !== ''))];
            
            if (uniqueChars.length < 6) {
                alert("ç”Ÿå­—æ•¸é‡å¤ªå°‘å›‰ï¼è«‹è‡³å°‘è¼¸å…¥ 6 å€‹ä¸åŒçš„åœ‹å­—ã€‚");
                return;
            }

            characters = uniqueChars;
            
            // è¨ˆç®—æ¯å¼µå¡ç‰‡å¯ä»¥æ”¾å¹¾å€‹å­—
            const maxPossibleSymbols = Math.floor((characters.length + 1) / 2);
            // ä¸Šé™è¨­ç‚º 8
            symbolsPerCard = Math.min(8, maxPossibleSymbols);

            // åˆ‡æ›ä»‹é¢
            document.getElementById('setupPanel').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'flex';
            
            document.getElementById('totalQuestions').textContent = characters.length;
            restartLevel();
        }

        // å›åˆ°è¨­å®šé é¢ (é‡æ–°å‡ºé¡Œ)
        function returnToSetup() {
            document.getElementById('gameContainer').style.display = 'none';
            document.getElementById('setupPanel').style.display = 'block';
            document.getElementById('gameComplete').style.display = 'none';
        }

        // é‡æ–°é–‹å§‹æœ¬å±€ (ä¸æ›å­—)
        function restartLevel() {
            currentQuestionNum = 1;
            score = 0;
            document.getElementById('score').textContent = '0';
            document.getElementById('gameComplete').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').disabled = true;
            
            generateQuestions();
            displayQuestion();
        }

        function generateQuestions() {
            gameQuestions = [];
            const totalQuestions = characters.length;
            for (let i = 0; i < totalQuestions; i++) {
                gameQuestions.push(generateQuestion());
            }
        }

        function generateQuestion() {
            const shuffled = [...characters].sort(() => Math.random() - 0.5);
            
            const commonChar = shuffled[0];
            const leftOthers = shuffled.slice(1, symbolsPerCard);
            
            const rightStartIndex = symbolsPerCard;
            const rightEndIndex = rightStartIndex + (symbolsPerCard - 1);
            const rightOthers = shuffled.slice(rightStartIndex, rightEndIndex);
            
            if (rightOthers.length < symbolsPerCard - 1) {
                const used = new Set([commonChar, ...leftOthers, ...rightOthers]);
                while (rightOthers.length < symbolsPerCard - 1) {
                    const randomChar = characters[Math.floor(Math.random() * characters.length)];
                    if (!used.has(randomChar)) {
                        rightOthers.push(randomChar);
                        used.add(randomChar);
                    } else if (characters.length <= (symbolsPerCard * 2 - 1)) {
                         if (randomChar !== commonChar && !leftOthers.includes(randomChar)) { 
                             rightOthers.push(randomChar);
                         }
                    }
                }
            }

            const leftCard = [commonChar, ...leftOthers].sort(() => Math.random() - 0.5);
            const rightCard = [commonChar, ...rightOthers].sort(() => Math.random() - 0.5);
            
            return {
                leftCard,
                rightCard,
                answer: commonChar
            };
        }

        function generateGridPositions(count, cardRadius) {
            const safeRadius = cardRadius * 0.78; 
            const positions = [];
            const maxAttempts = 3000;
            const minDistance = 110; 

            for (let i = 0; i < count; i++) {
                let placed = false;
                let attempts = 0;
                
                while (!placed && attempts < maxAttempts) {
                    const angle = Math.random() * Math.PI * 2;
                    const r = Math.sqrt(Math.random()) * safeRadius;
                    const x = Math.cos(angle) * r;
                    const y = Math.sin(angle) * r;
                    
                    let overlap = false;
                    for (const pos of positions) {
                        const dist = Math.sqrt((x - pos.x) ** 2 + (y - pos.y) ** 2);
                        if (dist < minDistance) {
                            overlap = true;
                            break;
                        }
                    }
                    
                    if (!overlap) {
                        positions.push({ x, y });
                        placed = true;
                    }
                    attempts++;
                }
                
                if (!placed) {
                     const fallbackRadius = 150;
                     const angle = (i / count) * Math.PI * 2;
                     positions.push({
                         x: Math.cos(angle) * fallbackRadius,
                         y: Math.sin(angle) * fallbackRadius
                     });
                }
            }
            return positions;
        }

        function displayQuestion() {
            const question = gameQuestions[currentQuestionNum - 1];
            currentAnswer = question.answer;
            questionAnswered = false;
            
            document.getElementById('leftCard').innerHTML = '';
            document.getElementById('rightCard').innerHTML = '';
            
            const cardRadius = 260;
            const currentSymbolCount = question.leftCard.length; 
            
            const leftPositions = generateGridPositions(currentSymbolCount, cardRadius);
            const rightPositions = generateGridPositions(currentSymbolCount, cardRadius);
            
            const allColors = [
                '#E53E3E', '#F56565', '#C53030', 
                '#DD6B20', '#ED8936', '#C05621', 
                '#D69E2E', '#ECC94B', '#B7791F', 
                '#38A169', '#48BB78', '#2F855A', 
                '#3182CE', '#4299E1', '#2B6CB0', 
                '#805AD5', '#9F7AEA', '#6B46C1', 
                '#D53F8C', '#ED64A6', '#B83280', 
                '#00B5D8', '#319795'              
            ];
            const usedColors = new Set();
            const questionColors = {};
            
            const allPositions = [...question.leftCard, ...question.rightCard];
            allPositions.forEach((char, index) => {
                const colorKey = `${char}_${index}`;
                let availableColors = allColors.filter(color => !usedColors.has(color));
                if (availableColors.length === 0) {
                    usedColors.clear();
                    availableColors = [...allColors];
                }
                const randomColor = availableColors[Math.floor(Math.random() * availableColors.length)];
                questionColors[colorKey] = randomColor;
                usedColors.add(randomColor);
            });
            
            // ä¿®æ­£é€™è£¡ï¼šå³å¡ç‰‡çš„ offset å¿…é ˆæ˜¯å·¦å¡ç‰‡çš„é•·åº¦
            renderCard(question.leftCard, 'leftCard', leftPositions, questionColors, 0);
            renderCard(question.rightCard, 'rightCard', rightPositions, questionColors, question.leftCard.length);
            
            document.getElementById('currentQuestion').textContent = currentQuestionNum;
            document.getElementById('nextBtn').disabled = true;
        }

        function renderCard(cardChars, elementId, positions, colors, colorIndexOffset) {
            const container = document.getElementById(elementId);
            cardChars.forEach((char, index) => {
                const charElement = document.createElement('div');
                charElement.className = 'character';
                
                const spanElement = document.createElement('span');
                spanElement.textContent = char;
                charElement.appendChild(spanElement);
                
                charElement.style.left = `50%`;
                charElement.style.top = `50%`;
                
                const posX = positions[index] ? positions[index].x : 0;
                const posY = positions[index] ? positions[index].y : 0;

                const randomRotation = Math.random() * 60 - 30;
                
                charElement.style.transform = `translate(calc(-50% + ${posX}px), calc(-50% + ${posY}px)) rotate(${randomRotation}deg)`;

                const colorKey = `${char}_${index + colorIndexOffset}`;
                
                spanElement.style.color = colors[colorKey];
                
                charElement.onclick = () => selectCharacter(char, charElement);
                container.appendChild(charElement);
            });
        }

        function selectCharacter(char, element) {
            if (questionAnswered) return;
            checkAnswer(char, element);
        }

        function checkAnswer(selectedChar, element) {
            if (selectedChar === currentAnswer) {
                questionAnswered = true; 
                score += 1;
                
                document.querySelectorAll('.character').forEach(el => {
                    if (el.innerText === currentAnswer) {
                        el.classList.add('correct'); 
                    }
                });
                
                showCelebration();
                
                document.getElementById('nextBtn').disabled = false;
                document.getElementById('score').textContent = score;
            } 
        }

        function showCelebration() {
            const leftRibbon = document.createElement('div');
            leftRibbon.className = 'ribbon left';
            document.body.appendChild(leftRibbon);
            
            const rightRibbon = document.createElement('div');
            rightRibbon.className = 'ribbon right';
            rightRibbon.style.animationDelay = '0.1s';
            document.body.appendChild(rightRibbon);
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => createConfetti(), i * 50);
            }
            setTimeout(() => {
                leftRibbon.remove();
                rightRibbon.remove();
            }, 3000);
        }

        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#a8e6cf', '#ffd93d'];
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
            confetti.style.animationDelay = Math.random() * 2 + 's';
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 5000);
        }

        function nextQuestion() {
            if (currentQuestionNum < characters.length) {
                currentQuestionNum++;
                displayQuestion();
            } else {
                document.getElementById('finalScore').textContent = score;
                document.getElementById('maxScore').textContent = characters.length;
                document.getElementById('gameComplete').style.display = 'block';
                document.getElementById('nextBtn').style.display = 'none';
            }
        }
    </script>
 </body>
</html>