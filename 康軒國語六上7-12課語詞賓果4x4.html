<!doctype html>
<html lang="zh-TW">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åº·è»’åœ‹èªå…­ä¸Šèªè©è³“æœ4x4</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            box-sizing: border-box;
        }
        
        .card {
            transition: all 0.3s ease;
            cursor: pointer;
            aspect-ratio: 1; /* ä¿æŒå¡ç‰‡ç‚ºæ­£æ–¹å½¢ */
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .card-content {
            transition: opacity 0.2s ease;
        }
        
        .animal-emoji {
            font-size: 4rem;
        }
        
        /* è³“æœé€£ç·šçš„ç´…ç·šæ¨£å¼ */
        .bingo-line {
            position: absolute;
            background-color: #ef4444; /* Tailwind red-500 */
            z-index: 20;
            border-radius: 9999px;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
            transition: opacity 0.5s ease;
        }

        /* è¬ç”¨æ ¼ (PASS) å°ˆå±¬æ¨£å¼ */
        .pass-card {
             /* ä¿æŒèˆ‡èªè©ç‹€æ…‹ä¸€è‡´çš„ç¶ è‰²èª¿ï¼Œä½†åŠ å…¥ç‰¹æ®Šé™°å½± */
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 0 0 10px rgba(0,0,0,0.15);
            transform: scale(1.03); 
        }

        /* è¨Šæ¯æ¡†æ¨£å¼ */
        #messageBox {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        #messageBox.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* å½©å¸¶ï¼ˆConfettiï¼‰æ•ˆæœå®¹å™¨ */
        #confettiContainer {
            position: fixed; 
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 50; 
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* å½©å¸¶å…ƒç´ å‹•ç•« */
        .confetti {
            position: absolute;
            width: 8px;
            height: 8px;
            background-color: transparent;
            border-radius: 50%;
            animation: confetti-fall 3s ease-in-out forwards;
            opacity: 0.8;
            transform-origin: center;
        }

        @keyframes confetti-fall {
            0% { transform: translate(var(--startX), -5vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translate(var(--endX), 105vh) rotate(720deg); opacity: 0; }
        }
        
        .definition-text {
            font-size: 1.0rem !important; 
            line-height: 1.2;
            overflow-wrap: break-word;
            word-break: break-word;
        }
        
        .term-text {
            font-size: 2.5rem; 
            font-weight: 600;
        }
        
        /* é‡å°è¡Œå‹•è£ç½®çš„æŒ‰éˆ•ä½ˆå±€èª¿æ•´ (å°æ–¼ lg è¢å¹•) */
        #lessonButtons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }
        /* é‡å°å¤§è¢å¹•çš„æŒ‰éˆ•ä½ˆå±€èª¿æ•´ (lg è¢å¹•åŠä»¥ä¸Š) */
        @media (min-width: 1024px) {
            #lessonButtons {
                display: flex; /* è®Šå› flex å®¹å™¨ */
                flex-direction: column; /* ç›´å‘æ’åˆ— */
                gap: 0.75rem; /* ä¿æŒé–“è· */
            }
        }

        .lesson-btn {
            @apply font-semibold py-2 px-3 rounded-lg transition duration-150 transform hover:scale-105 shadow-md;
        }
        .lesson-btn.active {
             @apply bg-pink-600 ring-2 ring-pink-300 text-white shadow-xl;
        }
        .lesson-btn:not(.active) {
            @apply bg-white text-indigo-700 hover:bg-indigo-50;
        }
    </style>
 </head>
 <body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-full p-4">
    <!-- 3ç§’å½©å¸¶å‹•ç•«å®¹å™¨ (fixed position) -->
    <div id="confettiContainer"></div>
    
    <!-- Main container to hold sidebar and game -->
    <div class="max-w-6xl mx-auto flex flex-col lg:flex-row gap-6"> 
        
        <!-- å·¦å´é¸èª²æŒ‰éˆ•å€å¡Š -->
        <div id="lessonButtons" class="flex-shrink-0 w-full lg:w-48 bg-white/70 p-4 rounded-xl shadow-2xl lg:order-1 order-2"> 
            <h3 class="text-xl font-bold text-gray-800 border-b pb-2 mb-2 lg:block hidden">é¸æ“‡èª²æ¬¡</h3>
            <!-- Buttons will be generated here by JS -->
        </div>

        <!-- ä¸»éŠæˆ²å€å¡Š -->
        <div id="gameArea" class="flex-grow lg:order-2 order-1">
            <!-- æ¨™é¡Œ -->
            <div class="text-center mb-6">
                <h1 id="gameTitle" class="text-4xl font-bold text-gray-800 mb-2">ä¸­æ–‡èªè©è³“æœ4x4</h1>
            </div>
            
            <div class="flex justify-center mb-6">
                <button id="resetButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg shadow-xl transition duration-150 transform hover:scale-105">
                    é‡æ–°é–‹å§‹
                </button>
            </div>
            
            <!-- å¡ç‰‡ç¶²æ ¼å®¹å™¨ (æ–°å¢ç›¸å°å®šä½) -->
            <div class="max-w-4xl mx-auto relative">
                <!-- Bingo Grid with ID -->
                <div class="grid grid-cols-4 gap-4" id="bingoGrid">
                    <!-- å¡ç‰‡æœƒç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <!-- Line and Confetti Overlay (çµ•å°å®šä½ï¼Œç”¨æ–¼ç¹ªè£½ç´…ç·š) -->
                <div id="bingoOverlay" class="absolute inset-0 pointer-events-none">
                    <!-- Red lines will be inserted here -->
                </div>
            </div>
            
            <!-- èªªæ˜ -->
            <div class="text-center mt-8 p-4 bg-white/70 rounded-lg backdrop-blur-sm max-w-4xl mx-auto">
                <p class="text-gray-700">ğŸ’¡ æç¤ºï¼šé»æ“Šå¡ç‰‡ï¼Œå¾ªç’°åˆ‡æ› **åœ–æ¡ˆ** â†’ **è§£é‡‹** â†’ **èªè© (æ¨™è¨˜)** ä¸‰å€‹ç‹€æ…‹ã€‚</p>
            </div>
        </div>
    </div>

  <script>
        // å…¨éƒ¨çš„èª²æ¬¡èªè©è³‡æ–™ (7~12èª²)
        const allLessonData = {
            7: {
                title: "ç¬¬ä¸ƒèª²ï¼šå¤§å°å‰›å¥½çš„é‹å­",
                vocab: [
                    { term: "è…³è¸", definition: "å°è…¿èˆ‡è…³æŒé–“ï¼Œè…³éª¨å…©æ—å‡¸èµ·çš„éƒ¨ä½ã€‚" },
                    { term: "å‘¢çµ¨", definition: "ç”¨ç¸æ¯›æˆ–äººé€ æ¯›ç­‰è£½æˆçš„æ¯›ç¹”å“çš„çµ±ç¨±ã€‚" },
                    { term: "ä¸‹è¥¬", definition: "ä¸Šè¡£ã€é•·è¢å’Œè£™å­ç­‰çš„ä¸‹ç·£éƒ¨åˆ†ã€‚" },
                    { term: "æ£æ„", definition: "æ”¾ä»»è€Œä¸åŠ ä»¥ç´„æŸã€‚" },
                    { term: "æ‰¹åˆ¤", definition: "è©•è«–åˆ¤æ–·ã€‚" },
                    { term: "è¡Œå¾‘", definition: "è¡Œç‚ºã€èˆ‰å‹•ã€‚" },
                    { term: "è¬¹è¨˜", definition: "â‘´æ­è¬¹ç‰¢è¨˜ã€‚â‘µæ­æ•¬æ…é‡çš„å¯«ä¸‹ã€‚" },
                    { term: "æ°æ°", definition: "æ°å·§ã€å‰›å¥½ã€‚" },
                    { term: "ä¹äººå•æ´¥", definition: "æ²’æœ‰äººæ´½è©¢æˆ–æ¢å•ã€‚" },
                    { term: "æ”¾ä¹‹å››æµ·è€Œçš†æº–", definition: "ç”¨åˆ°ä»»ä½•åœ°æ–¹ä»»ä½•æ–¹é¢éƒ½å¯ä½œç‚ºæº–å‰‡ã€‚" },
                    { term: "å—¤ä¹‹ä»¥é¼»", definition: "å¾é¼»å­è£¡ç™¼å‡ºå†·ç¬‘ã€‚è¡¨ç¤ºä¸å±‘æˆ–é„™è¦–ã€‚" }
                    // 11 å€‹è©å½™ï¼Œéœ€è¦ 5 å€‹ PASS
                ]
            },
            8: {
                title: "ç¬¬å…«èª²ï¼šç‹å‡è™å¨",
                vocab: [
                    { term: "ç¸«éš™", definition: "ç©ºéš™ã€‚" },
                    { term: "æ—¨æ„", definition: "â‘´å¸ç‹çš„å‘½ä»¤ã€‚â‘µä¸»æ—¨ç›®çš„ã€‚" },
                    { term: "æ‚ é–’", definition: "é–’é©è‡ªå¾—è€Œç„¡æ‰€ç‰½æ›ã€‚" },
                    { term: "å¯“è¨€", definition: "ä»¥æ·ºè¿‘å‡è¨—çš„æ•…äº‹æˆ–è‡ªç„¶ç‰©çš„æ“¬äººæ‰‹æ³•ï¼Œè¡¨é”æŸç¨®å“²ç†æˆ–éš±å«è¨“èª¨æ•™è‚²ä½œç”¨çš„æ–‡é«”ã€‚" },
                    { term: "é·¸èšŒç›¸çˆ­", definition: "æ¯”å–»å…©ç›¸çˆ­åŸ·å¿…æœƒé€ æˆå…©æ•—ä¿±å‚·ï¼Œè€Œè®“ç¬¬ä¸‰è€…ç²åˆ©çš„å±€é¢ã€‚" },
                    { term: "ç‹¡å…”ä¸‰çªŸ", definition: "ç‹¡çŒ¾çš„å…”å­æœ‰ä¸‰è™•è—èº«çš„æ´ç©´ã€‚æ¯”å–»äººæœ‰å¤šè™•è—èº«çš„åœ°æ–¹æˆ–å¤šç¨®é¿ç¦çš„æº–å‚™ã€‚" },
                    { term: "ç‹¡çŒ¾", definition: "è©­è®Šå¤šè©ã€‚" },
                    { term: "æ‹›æ–æ’é¨™", definition: "å‡å€Ÿä»–äººçš„åç¾©æˆ–è²å‹¢è€Œåˆ°è™•è©é¨™ã€‚" },
                    { term: "å½è£", definition: "å‡è£ï¼Œæ”¹è£æ©é£¾çœŸæ­£çš„é¢ç›®æˆ–èº«åˆ†ã€‚" },
                    { term: "èª‡å¤§", definition: "è¨€èªè¶…éåŸæœ‰çš„äº‹å¯¦ã€‚" },
                    { term: "åˆ†è¾¨", definition: "è¾¨åˆ¥ã€‚" },
                    { term: "è¬Šè¨€", definition: "ä¸å¯¦åœ¨çš„è©±ã€‚" },
                    { term: "è«·åˆº", definition: "ä»¥éš±å¾®çš„æ–¹å¼å˜²è«·è­åˆºã€‚" },
                    { term: "è­¦æƒ•", definition: "å°å¯èƒ½ç™¼ç”Ÿçš„æƒ…æ³ï¼Œå¿ƒç”Ÿè­¦è¦ºè€ŒåŠ ä»¥æˆ’å‚™ã€‚" },
                    { term: "è§€å¯Ÿ", definition: "ä»”ç´°å¯Ÿçœ‹ã€‚" },
                    { term: "è’™è”½", definition: "æ¬ºé¨™ã€éš±çäº‹å¯¦çš„çœŸç›¸ã€‚" }
                    // 16 å€‹è©å½™ (ç§»é™¤äº†è™›å¼µè²å‹¢)ï¼Œéœ€è¦ 0 å€‹ PASS
                ]
            },
            9: {
                title: "ç¬¬ä¹èª²ï¼šç©ºåŸè¨ˆ",
                vocab: [
                    { term: "èª˜æ•µ", definition: "å¼•èª˜æ•µäººã€‚" },
                    { term: "æ——å¹Ÿ", definition: "â‘´æ——æœ‰æ¨™å¹Ÿçš„åŠŸç”¨ï¼Œæ‰€ä»¥æ³›ç¨±æ—Œæ——ç‚ºï¹æ——å¹Ÿï¹‚ã€‚â‘µæ¯”å–»åç¾©ã€è—‰å£ã€‚" },
                    { term: "å´—ä½", definition: "â‘´è·è²¬ã€æœ¬åˆ†ã€‚â‘µè»è­¦åŸ·å‹¤çš„è™•æ‰€ã€‚" },
                    { term: "ç™¾å§“", definition: "æ³›æŒ‡ä¸€èˆ¬å¹³æ°‘ã€åœ‹æ°‘ã€‚" },
                    { term: "å€˜è‹¥", definition: "è¡¨ç¤ºå‡è¨­èªæ°£çš„é€£æ¥è©ï¼Œå³å¦‚æœã€å‡ä½¿ã€‚" },
                    { term: "æ›¸åƒ®", definition: "èˆŠæ™‚åœ¨å¯Œäººå®¶ä¸­ä¾å€™ä¸»äººæˆ–å…¶å¼Ÿå­è®€æ›¸ï¼Œå…¼åšé›œå½¹çš„æœªæˆå¹´åƒ®åƒ•ã€‚" },
                    { term: "æ’¤é€€", definition: "æ”¾æ£„é™£åœ°æˆ–é·é›¢å·²å é ˜çš„åœ°å€ã€‚" },
                    { term: "è¬¹æ…", definition: "ä»”ç´°æ…é‡ã€‚" },
                    { term: "ä¸ç›¸", definition: "å¤æ™‚è¼”ä½å¤©å­è™•ç†åœ‹äº‹çš„æœ€é«˜è¡Œæ”¿å®˜å“¡ã€‚å¤šç”±ä¸€äººæ“”ä»»ï¼Œæœ‰æ™‚äº¦ç”±äºŒäººæˆ–å¤šäººå…±åŒæŒæ”¿ã€‚" }
                    // 9 å€‹è©å½™ï¼Œéœ€è¦ 7 å€‹ PASS
                ]
            },
            10: {
                title: "ç¬¬åèª²ï¼šè€¶èª•ç¯€",
                vocab: [
                    { term: "è€¶èª•ç¯€", definition: "ç´€å¿µè€¶ç©Œèª•ç”Ÿçš„ç¯€æ—¥ã€‚è€¶ç©Œèª•è¾°ï¼Œè‡ªå¤å‚³èªªä¸ä¸€ï¼Œè¥¿å…ƒå››ä¸–ç´€æ™‚ï¼Œç¾…é¦¬äººå§‹å®šåäºŒæœˆäºŒåäº”æ—¥ç‚ºè€¶ç©Œèª•è¾°ï¼Œæ˜¯æ­ç¾é‡è¦ç¯€æ…¶ä¹‹ä¸€ã€‚" },
                    { term: "éƒŠå¤–", definition: "ç’°ç¹åŸå¸‚å¤–é¢çš„åœ°æ–¹ã€‚" },
                    { term: "æ…ˆç¥¥", definition: "æ…ˆå–„ç¥¥å’Œã€‚" },
                    { term: "åŠˆå•ª", definition: "ç‹€è²è©ã€‚å½¢å®¹ç‡ƒç‡’æ™‚çˆ†è£‚æˆ–æ’æ“Šæ‹æ‰“çš„è²éŸ³ã€‚" },
                    { term: "é›¶ç”¨éŒ¢", definition: "é›¶ç¢èŠ±ç”¨çš„éŒ¢ã€‚" },
                    { term: "å­å€¦", definition: "ä¸å†å–œæ­¡æˆ–æä¸èµ·èˆˆè¶£ã€‚" },
                    { term: "è¾¯è­·", definition: "â‘´æå‡ºç†ç”±ã€äº‹å¯¦ä¾†åŠ ä»¥è¢’è­·ã€‚â‘µæ³•å¾‹ä¸ŠæŒ‡è¾¯è­·äººç‚ºä¿è­·ç•¶äº‹äººçš„åˆ©ç›ŠåŠæ¬Šåˆ©ï¼Œé˜²ç¦¦ä¸æ³•æˆ–ä¸ç•¶çš„æŒ‡æ§ï¼Œåœ¨å£é ­æˆ–æ–‡å­—ä¸Šæ‰€åšçš„è¾¯ç™½ã€‚" },
                    { term: "è‡ªç§è‡ªåˆ©", definition: "åªåœ–è‡ªå·±çš„ç§åˆ©ï¼Œè€Œä¸é¡§åŠä¸€åˆ‡ã€‚" },
                    { term: "è²§çª®", definition: "ç¼ºå°‘éŒ¢è²¡ï¼Œç”Ÿæ´»æ‹®æ®å›°ä¹ã€‚" },
                    { term: "é—œä¿‚", definition: "â‘´å°ç›¸é—œäº‹ç‰©çš„å½±éŸ¿ã€ç‰½æ¶‰ã€‚â‘µæ³›æŒ‡åŸå› ã€æ¢ä»¶ç­‰ã€‚â‘¶äººäº‹ç‰©é–“çš„é—œé€£æƒ…å½¢ã€‚" },
                    { term: "ç¨å¾®", definition: "ç¨‹åº¦æˆ–åˆ†é‡ä¸Šæ¥µå°‘çš„ã€‚" },
                    { term: "æš–çƒ˜çƒ˜", definition: "æº«æš–çš„æ¨£å­ã€‚" },
                    { term: "è¡·å¿ƒ", definition: "å‡ºè‡ªå…§å¿ƒã€‚" },
                    { term: "é‹¼ç´", definition: "æ¨‚å™¨åã€‚å±¬éµç›¤æ¨‚å™¨ã€‚å½¢ç‹€åƒé¢¨ç´ï¼Œé«”ç©è¼ƒå¤§ï¼Œå…§è£æœ‰è¨±å¤šé‹¼çµ²å¼¦å’ŒåŒ…çµ¨æ°ˆçš„æœ¨éŒ˜ï¼Œæ‰‹æŒ‡æŒ‰å‹•éµç›¤æ™‚ï¼Œç‰½å‹•éµç›¤ä¸‹çš„å°æœ¨éŒ˜æ•²æ‰“é‹¼çµ²å¼¦è€Œç™¼å‡ºè²éŸ³ã€‚åå…«ä¸–ç´€ä¸­è‘‰ä»¥å¾Œå»£æ³›æµè¡Œã€‚" }
                    // 14 å€‹è©å½™ï¼Œéœ€è¦ 2 å€‹ PASS
                ]
            },
            11: {
                title: "ç¬¬åä¸€èª²ï¼šä¸‹åˆèŒ¶é¢¨æ³¢",
                vocab: [
                    { term: "æ¢å¾©", definition: "â‘´å›å¾©åˆ°åŸä¾†çš„æ¨£å­ã€‚â‘µæ”¶å¾©ï¼Œå°‡å¤±å»çš„æ”¶å›ä¾†ã€‚" },
                    { term: "æ´»æ½‘", definition: "ç”Ÿå‹•è€Œä¸å‘†æ¿ã€‚" },
                    { term: "è‰è“", definition: "æ¤ç‰©åã€‚å¤šå¹´ç”Ÿè‰æœ¬æ¤ç‰©ã€‚å…¨æ ªè¢«çµ¨æ¯›ï¼Œè‘‰æ ¹ç”Ÿå¢å‡ºï¼Œæœ‰é•·æŸ„ï¼Œè‘—ç”Ÿä¸‰ç‰‡é‚Šç·£æœ‰ç¼ºåˆ»çš„å°è‘‰ã€‚èŠ±ç™½è‰²ï¼Œæœå¯¦ä¹Ÿç¨±ï¹è‰è“ï¹‚ï¼Œç†Ÿå‘ˆç´…è‰²ï¼Œè‚‰è³ªå¤šæ±ï¼Œå‘³é“é…¸ç”œï¼Œå¯ç”Ÿé£Ÿï¼Œäº¦å¯è£½æœé†¬ã€‚" },
                    { term: "å®¢å»³", definition: "ç”¨ä¾†æ¥å¾…è³“å®¢çš„å ´æ‰€ã€‚" },
                    { term: "å‰é¡", definition: "é¡é ­ã€‚" },
                    { term: "çŒé†‰", definition: "å‹‰å¼·åˆ¥äººå–é…’ä»¥è‡´æ–¼é…’é†‰ã€‚" },
                    { term: "åŸè«’", definition: "å¯¬æ•è«’è§£ã€‚" },
                    { term: "é›™è„£", definition: "ä¸Šã€ä¸‹å˜´è„£ã€‚" },
                    { term: "ä¹æ±‚", definition: "æ‡‡æ±‚ã€è«‹æ±‚ã€‚" },
                    { term: "ç¥é‡‡ç…¥ç™¼", definition: "ç²¾ç¥å……è¶³ï¼Œå…‰é‡‡ç…§äººã€‚" },
                    { term: "é›ªæ©‡", definition: "åˆ©ç”¨é•·æ¢å½¢å¹³æ»‘æ¿å¡Šåœ¨é›ªåœ°ä¸Šæ»‘è¡Œçš„ç„¡è¼ªäº¤é€šå·¥å…·ã€‚æœ€åˆæ˜¯ç”±ç‹—æˆ–é¹¿æ‹‰å‹•ï¼Œç¾æœ‰ä»¥æ©Ÿæ¢°å¸¶å‹•çš„ã€‚ä¹Ÿç¨±ç‚ºï¹å†°æ©‡ï¹‚ã€ï¹é›ªè»Šï¹‚ã€‚" },
                    { term: "è¿´ç›ª", definition: "è¿´æ—‹é£„æµ®ã€‚" }
                    // 12 å€‹è©å½™ï¼Œéœ€è¦ 4 å€‹ PASS
                ]
            },
            12: {
                title: "ç¬¬åäºŒèª²ï¼šç¥•å¯†èŠ±åœ’",
                vocab: [
                    { term: "è¨ç•°", definition: "è¦ºå¾—æ„å¤–ï¼Œé›£ä»¥ç›¸ä¿¡ã€‚" },
                    { term: "è‡‰é °", definition: "è‡‰çš„å…©é‚Šã€‚" },
                    { term: "è“¬å‹ƒ", definition: "èŒ‚ç››ç¹æ¦®çš„æ¨£å­ã€‚" },
                    { term: "å®¶åº­é†«å¸«", definition: "ç…§é¡§å®¶åº­å„æˆå“¡å¥åº·çš„ç¬¬ä¸€ç·šé†«å¸«ã€‚é€šå¸¸ç”±ç¤¾å€ä¸­é–‹æ¥­çš„å…¨ç§‘é†«å¸«ï¼Œæˆ–è¡›ç”Ÿæ©Ÿæ§‹çš„é†«å¸«ä¾†æ“”ç•¶ã€‚" },
                    { term: "åš´è‚…", definition: "â‘´æ…‹åº¦åš´æ­£èŠé‡ã€‚â‘µåš´æ ¼ã€èªçœŸã€‚" },
                    { term: "è–”è–‡", definition: "æ¤ç‰©åã€‚è–”è–‡ç§‘è–”è–‡å±¬ï¼Œå¸¸ç¶ æˆ–è½è‘‰çŒæœ¨ã€‚æå¹¹å¤šåˆºï¼Œè‘‰ç‚ºå¥‡æ•¸ç¾½ç‹€è¤‡è‘‰ï¼Œé‚Šç·£æœ‰é‹¸é½’ã€‚èŠ±æœµç‚ºå…©æ€§èŠ±ï¼Œæœ‰ç´…ã€ç™½ã€é»ƒç­‰è‰²ï¼Œå¯Œæœ‰é¦™æ°£ã€‚å¯ä½œè§€è³ç”¨ï¼Œäº¦å¯åŠ å·¥è£½ä½œè–”è–‡æ²¹å’Œè–”è–‡éœ²ã€‚" },
                    { term: "ç€°æ¼«", definition: "éå¸ƒã€æ»¿å¸ƒã€‚" },
                    { term: "åŒ…æ‹¬", definition: "åŒ…å«ã€æ¶µè“‹ã€‚" },
                    { term: "èèŸ»", definition: "èŸ»ç§‘æ˜†èŸ²çš„ç¸½ç¨±ã€‚ä¸€èˆ¬é«”å°ï¼Œæœ‰é»‘ã€è¤ã€ç´…ç­‰è‰²ï¼Œé«”åˆ†é ­ã€èƒ¸ã€è…¹ä¸‰éƒ¨åˆ†ã€‚è·åˆ†å¥³ç‹èŸ»ã€é›„èŸ»ã€å·¥èŸ»ä¸‰ç¨®ã€‚å–œæ–¼åœ°ä¸‹ç¯‰å·¢ç¾¤å±…ï¼Œç¨®é¡å¾ˆå¤šã€‚" },
                    { term: "å„˜ç®¡", definition: "â‘´å³ä½¿ã€é›–ç„¶ã€‚â‘µä¸ç”¨è€ƒæ…®å…¶ä»–å› ç´ æˆ–åŠ ä»¥ç¯€åˆ¶ï¼Œéš¨æ„å»åšã€‚" }
                    // 10 å€‹è©å½™ï¼Œéœ€è¦ 6 å€‹ PASS
                ]
            }
        };

        // è³“æœå¡ç‰‡ç¸½æ•¸
        const CARD_COUNT = 16;
        const LESSON_EMOJIS = [
            "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸ¥", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸ’", 
            "ğŸ", "ğŸ‘", "ğŸ¥­", "ğŸ¥¥", "ğŸ¥‘", "ğŸ¥•", "ğŸ¥¦", "ğŸ„"
        ];
        
        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        let currentLesson = 7; // é è¨­è¼‰å…¥ç¬¬ä¸ƒèª²
        let vocabulary = []; // ç•¶å‰è¢«æ‰“äº‚çš„èªè©é †åº (åŒ…å« PASS)
        let cardStates = []; // å¡ç‰‡ç‹€æ…‹ï¼š0=å‹•ç‰©, 1=è§£é‡‹, 2=èªè©(æ¨™è¨˜)
        let markedCards = []; // è³“æœæ¨™è¨˜ç‹€æ…‹ (å¸ƒæ—å€¼)

        // éš¨æ©Ÿæ‰“äº‚é™£åˆ—
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // -----------------------
        // UI & è¨Šæ¯é‚è¼¯
        // -----------------------

        // é¡¯ç¤ºè¨Šæ¯æ¡†ï¼ˆå–ä»£ alert()ï¼‰
        function showMessage(title, message) {
            let messageBox = document.getElementById('messageBox');
            if (!messageBox) {
                messageBox = document.createElement('div');
                messageBox.id = 'messageBox';
                messageBox.className = 'fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 transition-opacity duration-300';
                document.body.appendChild(messageBox);
            }
            
            messageBox.innerHTML = `
                <div class="bg-white p-8 rounded-xl shadow-2xl max-w-sm text-center transform scale-100 transition-transform duration-300">
                    <div class="text-4xl mb-4">${title === "è³“æœï¼" ? "ğŸ‰" : "ğŸ’¡"}</div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">${title}</h2>
                    <p class="text-gray-600 mb-6">${message}</p>
                    <button onclick="document.getElementById('messageBox').classList.remove('active')" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition duration-150">
                        ç¢ºå®š
                    </button>
                </div>
            `;
             messageBox.classList.add('active');
        }

        // é¡¯ç¤ºå½©å¸¶ç•«é¢ (Confetti) 3ç§’
        function showConfetti() {
            const container = document.getElementById('confettiContainer');
            if (!container) return;
            
            container.innerHTML = ''; 
            container.style.opacity = '1';
            
            const colors = ['#f43f5e', '#6366f1', '#10b981', '#f59e0b', '#3b82f6']; 
            const count = 50; 

            for (let i = 0; i < count; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                const size = Math.random() * 8 + 4; 
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                const startX = Math.random() * 100 + 'vw';
                const endX = Math.random() * 100 + 'vw';

                confetti.style.setProperty('--startX', startX);
                confetti.style.setProperty('--endX', endX);

                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                
                container.appendChild(confetti);
            }

            setTimeout(() => {
                container.style.opacity = '0';
                setTimeout(() => {
                    container.innerHTML = '';
                }, 500); 
            }, 3000);
        }

        // -----------------------
        // è³“æœ/å¡ç‰‡é‚è¼¯
        // -----------------------
        
        // ç¹ªè£½è³“æœé€£ç·š
        function drawBingoLines(lines) {
            const overlay = document.getElementById('bingoOverlay');
            if (!overlay) return;

            overlay.innerHTML = '';

            const grid = document.getElementById('bingoGrid');
            if (!grid) return;
            const gridRect = grid.getBoundingClientRect();
            
            const cardElements = Array.from(grid.children);
            
            lines.forEach(indices => {
                // æ‰¾åˆ°é€£ç·šä¸­çš„ç¬¬ä¸€å€‹å’Œæœ€å¾Œä¸€å€‹å¡ç‰‡
                const startCard = cardElements[indices[0]];
                const endCard = cardElements[indices[indices.length - 1]];

                if (!startCard || !endCard) return;

                const startRect = startCard.getBoundingClientRect();
                const endRect = endCard.getBoundingClientRect();

                // è¨ˆç®—ç›¸å°æ–¼ overlay/grid container çš„ä¸­å¿ƒé»ä½ç½®
                const startX = startRect.left + startRect.width / 2 - gridRect.left;
                const startY = startRect.top + startRect.height / 2 - gridRect.top;
                const endX = endRect.left + endRect.width / 2 - gridRect.left;
                const endY = endRect.top + endRect.height / 2 - gridRect.top;

                // è¨ˆç®—è·é›¢ (é•·åº¦) å’Œè§’åº¦
                const dx = endX - startX;
                const dy = endY - startY;
                const length = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;

                // å‰µå»ºä¸¦è¨­å®šé€£ç·šå…ƒç´ æ¨£å¼
                const line = document.createElement('div');
                line.className = 'bingo-line';
                // èª¿æ•´ç·šæ¢çš„èµ·é»ï¼Œè®“å®ƒå±…ä¸­
                line.style.left = `${startX}px`;
                line.style.top = `${startY}px`;
                line.style.width = `${length}px`;
                line.style.height = '8px'; 
                line.style.transformOrigin = '0 0'; 
                line.style.transform = `rotate(${angle}deg)`;

                overlay.appendChild(line);
            });
        }

        // æª¢æŸ¥æ˜¯å¦é”æˆè³“æœ
        function checkForBingo() {
            const size = 4;
            const lines = []; // å„²å­˜é”æˆé€£ç·šçš„å¡ç‰‡ç´¢å¼•åˆ—è¡¨
            
            // è¼”åŠ©å‡½å¼ï¼šæª¢æŸ¥ä¸¦æ·»åŠ é€£ç·š
            function addLine(indices) {
                if (indices.every(i => markedCards[i])) {
                    lines.push(indices);
                }
            }

            // æª¢æŸ¥æ©«æ’ (Rows)
            for (let i = 0; i < size; i++) {
                const rowIndices = [];
                for (let j = 0; j < size; j++) {
                    rowIndices.push(i * size + j);
                }
                addLine(rowIndices);
            }

            // æª¢æŸ¥ç›´è¡Œ (Columns)
            for (let j = 0; j < size; j++) {
                const colIndices = [];
                for (let i = 0; i < size; i++) {
                    colIndices.push(i * size + j);
                }
                addLine(colIndices);
            }

            // æª¢æŸ¥å°è§’ç·š (Diagonals)
            const diag1Indices = [];
            for (let i = 0; i < size; i++) {
                diag1Indices.push(i * size + i);
            }
            addLine(diag1Indices);

            const diag2Indices = [];
            for (let i = 0; i < size; i++) {
                diag2Indices.push(i * size + (size - 1 - i));
            }
            addLine(diag2Indices);

            if (lines.length > 0) {
                showMessage("è³“æœï¼", `æ­å–œæ‚¨é”æˆ ${lines.length} æ¢é€£ç·šï¼`);
                drawBingoLines(lines); // ç¹ªè£½ç´…ç·š
                showConfetti(); // é¡¯ç¤ºå½©å¸¶å‹•ç•«
            } else {
                document.getElementById('bingoOverlay').innerHTML = '';
            }
        }
        
        // å°‡æ–‡å­—æŒ‰æ¯è¡Œ6å€‹å­—æ’åˆ—ï¼Œä¸¦é¿å…æœ«è¡Œåƒ… 1 æˆ– 2 å­—
        function formatTextIn6x4(text) {
            const chars = [];
            const charsPerLine = 6; 
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                chars.push(char);
                
                const isEndOfChunk = (i + 1) % charsPerLine === 0;
                const hasMoreChars = i < text.length - 1;
                
                if (isEndOfChunk && hasMoreChars) {
                    const remainingChars = text.length - (i + 1);
                    
                    if (remainingChars > 2) { 
                        chars.push('<br>');
                    }
                }
            }
            
            return chars.join('');
        }

        // æ›´æ–°å¡ç‰‡å…§å®¹
        function updateCardContent(index) {
            const content = document.getElementById(`card-${index}`);
            const item = vocabulary[index];
            const state = cardStates[index];
            
            content.parentElement.classList.remove('pass-card');
            
            if (state === 0) {
                // å‹•ç‰©ç‹€æ…‹ (é è¨­ç‹€æ…‹)
                content.innerHTML = `<div class="animal-emoji">${item.animal}</div>`;
                content.parentElement.className = 'card bg-gradient-to-br from-yellow-100 to-orange-100 rounded-xl shadow-lg p-4 flex items-center justify-center border-2 border-yellow-200';
            } else if (state === 1) {
                // è§£é‡‹ç‹€æ…‹
                const formattedText = formatTextIn6x4(item.definition); 
                content.innerHTML = `<div class="definition-text text-gray-700 px-2 text-center">${formattedText}</div>`;
                content.parentElement.className = 'card bg-gradient-to-br from-blue-100 to-purple-100 rounded-xl shadow-lg p-4 flex items-center justify-center border-2 border-blue-200';
                
            } else {
                // èªè©ç‹€æ…‹ (æ¨™è¨˜ç‹€æ…‹)
                let termText = item.term;
                
                if (item.term === "PASS") {
                    termText = "PASS"; 
                    content.parentElement.classList.add('pass-card'); 
                }

                content.innerHTML = `<div class="term-text text-gray-800">${termText}</div>`;
                content.parentElement.className = 'card bg-gradient-to-br from-green-100 to-teal-100 rounded-xl shadow-lg p-4 flex items-center justify-center border-2 border-green-200';
            }
        }

        // æ’­æ”¾éŸ³æ•ˆ
        function playClickSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // åˆ‡æ›å¡ç‰‡ç‹€æ…‹ (å·²æ ¹æ“šç”¨æˆ¶è¦æ±‚ä¿®æ”¹è¬ç”¨æ ¼é‚è¼¯)
        function toggleCard(index) {
            playClickSound();
            const isPassCard = vocabulary[index].term === "PASS";
            
            if (isPassCard) {
                // PASSå¡ç‰‡ï¼šåªåœ¨ 0 (åœ–æ¡ˆ) å’Œ 2 (PASS) ä¹‹é–“åˆ‡æ›
                if (cardStates[index] === 0) {
                    cardStates[index] = 2; // 0 (åœ–æ¡ˆ) -> 2 (PASS/æ¨™è¨˜)
                } else {
                    cardStates[index] = 0; // 2 (PASS/æ¨™è¨˜) -> 0 (åœ–æ¡ˆ)
                }
            } else {
                // ä¸€èˆ¬å¡ç‰‡ï¼šå¾ªç’° 0 (åœ–æ¡ˆ), 1 (è§£é‡‹), 2 (èªè©)
                cardStates[index] = (cardStates[index] + 1) % 3;
            }

            updateCardContent(index);

            // å¦‚æœå¡ç‰‡åˆ‡æ›åˆ°èªè©ç‹€æ…‹(2)ï¼Œå‰‡è¦–ç‚ºæ¨™è¨˜
            markedCards[index] = cardStates[index] === 2;
            
            checkForBingo(); // æ¯æ¬¡æ¨™è¨˜å¾Œæª¢æŸ¥è³“æœ
        }

        // åˆå§‹åŒ–éŠæˆ²ç›¤é¢
        function initializeGame() {
            const grid = document.getElementById('bingoGrid');
            grid.innerHTML = ''; 
            
            // æ¸…é™¤é€£ç·šå’Œå½©å¸¶æ•ˆæœ
            document.getElementById('bingoOverlay').innerHTML = '';
            const confettiContainer = document.getElementById('confettiContainer');
            if (confettiContainer) {
                confettiContainer.style.opacity = '0';
                confettiContainer.innerHTML = '';
            }

            // ç”Ÿæˆå¡ç‰‡
            vocabulary.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card bg-white rounded-xl shadow-lg p-4 flex items-center justify-center border-2 border-gray-100';
                card.onclick = () => toggleCard(index);
                
                const content = document.createElement('div');
                content.className = 'card-content text-center w-full h-full flex items-center justify-center';
                content.id = `card-${index}`;
                
                card.appendChild(content);
                grid.appendChild(card);
                
                updateCardContent(index);
            });
            
            document.getElementById('messageBox')?.classList.remove('active'); 
        }
        
        // è¼‰å…¥æŒ‡å®šèª²æ¬¡çš„èªè©ä¸¦å•Ÿå‹•éŠæˆ²
        function loadLesson(lessonNumber) {
            currentLesson = lessonNumber;
            const lesson = allLessonData[lessonNumber];
            if (!lesson) return;

            // 1. æ›´æ–°æ¨™é¡Œ
            document.getElementById('gameTitle').textContent = `ä¸­æ–‡èªè©è³“æœ4x4 - ${lesson.title}`;

            // 2. æº–å‚™èªè©åˆ—è¡¨
            let currentVocab = [...lesson.vocab];
            
            // 3. å¡«å…… PASS å¡ç‰‡
            const passNeeded = CARD_COUNT - currentVocab.length;
            if (passNeeded > 0) {
                const passEmojis = shuffleArray(LESSON_EMOJIS).slice(0, passNeeded);
                for (let i = 0; i < passNeeded; i++) {
                    currentVocab.push({ 
                        term: "PASS", 
                        definition: "è¬ç”¨æ ¼ï¼Œå¯è‡ªç”±é¸æ“‡æ˜¯å¦ç¿»é–‹ã€‚", 
                        isPass: true 
                    });
                }
            }
            
            // 4. æ‰“äº‚é †åº
            vocabulary = shuffleArray(currentVocab);
            
            // 5. åˆ†é…ä¸¦æ‰“äº‚è¡¨æƒ…ç¬¦è™Ÿ
            const shuffledEmojis = shuffleArray(LESSON_EMOJIS);
            vocabulary.forEach((item, index) => {
                // å¦‚æœä¸æ˜¯ PASSï¼Œåˆ†é…ä¸€å€‹éš¨æ©Ÿè¡¨æƒ…ç¬¦è™Ÿ
                if (!item.isPass) {
                    item.animal = shuffledEmojis[index % shuffledEmojis.length]; 
                } else {
                    // PASS å°ˆå±¬è¡¨æƒ…ç¬¦è™Ÿï¼Œç¢ºä¿å’Œèªè©çš„ç¬¦è™Ÿä¸åŒï¼Œé€™è£¡ç”¨æ˜Ÿè™Ÿ
                    item.animal = "â­";
                }
            });
            
            // 6. é‡è¨­ç‹€æ…‹
            // åˆå§‹ç‹€æ…‹éƒ½è¨­å®šç‚º 0 (åœ–æ¡ˆ)
            cardStates = new Array(vocabulary.length).fill(0);
            markedCards = new Array(vocabulary.length).fill(false);
            
            // 7. é‡æ–°åˆå§‹åŒ–éŠæˆ²ç›¤é¢
            initializeGame();
            
            // 8. æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            updateButtonStates(lessonNumber);
        }

        // å»ºç«‹ä¸¦é¡¯ç¤ºèª²æ¬¡é¸æ“‡æŒ‰éˆ•
        function createLessonButtons() {
            const container = document.getElementById('lessonButtons');
            const lessonKeys = Object.keys(allLessonData).map(Number).sort((a, b) => a - b);
            
            lessonKeys.forEach(key => {
                const button = document.createElement('button');
                button.textContent = `ç¬¬${key}èª²`;
                button.className = 'lesson-btn';
                button.id = `btn-lesson-${key}`;
                button.onclick = () => loadLesson(key);
                container.appendChild(button);
            });
        }
        
        // æ›´æ–°æŒ‰éˆ•çš„ active ç‹€æ…‹
        function updateButtonStates(activeLesson) {
             const buttons = document.querySelectorAll('.lesson-btn');
             buttons.forEach(btn => {
                 const lessonNumber = parseInt(btn.id.replace('btn-lesson-', ''), 10);
                 if (lessonNumber === activeLesson) {
                     btn.classList.add('active');
                 } else {
                     btn.classList.remove('active');
                 }
             });
        }
        
        // å•Ÿå‹•éŠæˆ²å’Œç¶å®šæŒ‰éˆ•äº‹ä»¶
        document.addEventListener('DOMContentLoaded', () => {
            // 1. å»ºç«‹èª²æ¬¡æŒ‰éˆ•
            createLessonButtons();

            // 2. é è¨­è¼‰å…¥ç¬¬ä¸ƒèª² (ç¬¬ä¸€å€‹æŒ‰éˆ•)
            loadLesson(7);

            // 3. ç¶å®šé‡æ–°é–‹å§‹æŒ‰éˆ•äº‹ä»¶
            const resetButton = document.getElementById('resetButton');
            if (resetButton) {
                // é‡æ–°é–‹å§‹åªéœ€è¦èª¿ç”¨ initializeGameï¼Œå› ç‚º loadLesson å·²ç¶“æº–å‚™å¥½ vocabulary é™£åˆ—
                resetButton.addEventListener('click', () => {
                     // é‡æ–°è¼‰å…¥ç•¶å‰èª²æ¬¡ï¼Œé”åˆ°å®Œå…¨é‡ç½®æ•ˆæœ
                     loadLesson(currentLesson);
                });
            }
            
            // ç¢ºä¿åœ¨è¦–çª—å¤§å°æ”¹è®Šæ™‚ï¼Œé€£ç·šèƒ½æ­£ç¢ºé‡ç¹ª
            window.addEventListener('resize', () => {
                // åœ¨ resize æ™‚ï¼Œå…ˆæ¸…é™¤é€£ç·šï¼Œè®“ä½¿ç”¨è€…é»æ“Šå¡ç‰‡æ™‚å†é‡ç¹ª
                document.getElementById('bingoOverlay').innerHTML = '';
            });
        });
    </script>
 </body>
</html>